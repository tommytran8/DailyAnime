<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="author" content="Tommy Tran">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge"/>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@700&display=swap" rel="stylesheet">
        <link rel="icon" type="image/png" href="./assets/logo.png">
        <title>Daily Anime</title>

        <style>
            body {
                font-family: 'Lato', sans-serif;
            }

            [class*="col"] {
                padding: 1rem;
                background-color: #54b6f1;
                border: 2px solid white;
                color: white;
                /* text-align: center; */
            }
            button {
                font-family: 'Ubuntu', sans-serif;
                color: white;
            }

            #ALL {
                border: none;
                background-color: #54b6f1;
            }

            #ALL:hover {
                background-color: #7ec8f7;
                border-radius: 10%;
            }
        </style>
    </head>

    <body>
        
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <nav>
                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                          <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true" id="Sunday">Sunday</button>
                          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false" id="Monday">Monday</button>
                          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false" id="Tuesday">Tuesday</button>
                          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false" id="Wednesday">Wednesday</button>
                          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false" id="Thursday">Thursday</button>
                          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false" id="Friday">Friday</button>
                          <button class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false" id="Saturday">Saturday</button>
                          <button type="button" id="ALL">ALL</button>
                        </div>
                    </nav>
                </div>
                <!-- components added here -->
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
        <script>
            class Animecontainer extends HTMLElement {
                constructor() {
                    // Always call super first in constructor
                    super();
                    this.attachShadow({mode: 'open'});

                    let container = document.createElement('div');
                    container.setAttribute('class', "anime");


                    let name = document.createElement('p');
                    name.setAttribute('class', "title");
                    let score = document.createElement('p');
                    score.setAttribute('class', "score");
                    let airs =  document.createElement('p');
                    airs.setAttribute('class', "day-airs")
                    let description =  document.createElement('p');
                    description.setAttribute('class', "description")
                    let image = document.createElement('img');
                    image.setAttribute('class', "anime-image");

                    let containerBody = document.createElement('div');
                    containerBody.setAttribute('class', "anime-body");

                    let link =  document.createElement('a');



                    containerBody.appendChild(name);
                    containerBody.appendChild(score);
                    containerBody.appendChild(airs);
                    containerBody.appendChild(description);
                    link.appendChild(image);
                    container.appendChild(link);
                    container.appendChild(containerBody);
                    

                    this.name = name;
                    this.score = score;
                    this.airs = airs;
                    this.description = description;
                    this.image = image;
                    this.link = link;


                    const style = document.createElement('style');
                    style.textContent = `
                        .anime {
                            display: flex;
                        }
                        .anime-body {
                            padding: 1rem;
                        }

                        .description {
                            height: 150px;
                            overflow-y: auto;
                        }

                        .title {
                            font-family: 'Ubuntu', sans-serif;
                        }
                    `
                    this.shadowRoot.append(style, container);
                }
            }
            customElements.define('anime-container', Animecontainer);
        </script>
        <script>
            document.getElementById("ALL").addEventListener("click", ()=>{
                window.open("https://myanimelist.net/anime/season");
            });

            fetch(`${window.location.href}data`)
                .then(response => response.json())
                .then(data => { 
                    const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
                    const row = document.getElementsByClassName("row")[0];
                    days.forEach(day => {
                        data.forEach(anime => {
                            if (anime["day"].startsWith(day)){
                                let component = document.createElement('anime-container');
                                let score = anime["score"].startsWith("N/A") ? "N/A" : anime["score"].slice(0, anime["score"].indexOf(".") + 3);
                                component.setAttribute("class", `col-sm-12 ${day}`);
                                component.link.href = anime["url"];
                                component.link.target = "_blank";
                                component.name.textContent = `Title: ${anime["name"]}`;
                                component.score.textContent = `Score: ${score}`;
                                component.airs.textContent = `Boardcast : ${anime["day"]}`;
                                component.description.textContent = `Synposis : ${anime["description"]}`;
                                component.image.src = `${anime["imageURL"]}`;

                                //use popularity to order the items in the days
                                row.append(component);
                            }
                        });

                        document.getElementById(day).addEventListener('click', ()=>{
                            for (const component of document.getElementsByClassName("col-sm-12")) {
                                component.style.display = "none";
                            }
                            document.getElementsByClassName("col-sm-12")[0].style.display = "block";
                            for (const component of document.getElementsByClassName(day)) {
                                component.style.display = "block";
                            }
                        });
                    });
                    for (const component of document.getElementsByClassName("col-sm-12")) {
                        component.style.display = "none";
                    }
                    document.getElementsByClassName("col-sm-12")[0].style.display = "block";
                    for (const component of document.getElementsByClassName("Sunday")) {
                        component.style.display = "block";
                    }
            
                });            
            
        </script>
    </body>
</html>

